sh bin/setups/deps

set -a
source config/.env.sample

lando start

cd app
lando wp core download --locale=es_ES

# Using composer and wp-packagist
cd ..
echo "Installing packages with Composer..."
composer install

# Extraer el directorio de WordPress de .lando.yml
WEBROOT='grep webroot .lando.yml | cut -d: -f2 | xargs'

# Extraer los credenciales de la base de datos
DB_NAME='lando info --service database --format json | jq -r ".[0].creds.database"'
DB_USER='lando info --service database --format json | jq -r ".[0].creds.user"'
DB_PASSWORD='lando info --service database --format json | jq -r ".[0].creds.password"'
DB_HOST='lando info --service database --format json | jq -r ".[0].hostnames[0]"'
# Coger una URL para WordPress que no sea localhost y que s√≠ use https
WP_HOME_URL='lando info --service appserver --format json | jq -r ".[0].urls" | grep -vw localhost | grep https:'

# Instalar WordPress
lando wp core install
 --url=$WP_HOME_URL
 --title="$SITE_NAME"
 --admin_user=admin
 --admin_password=password
 --admin_email=admin@$DOMAIN
 --path=$WEBROOT

envsubst < config/.env.example > config/.env
set +a

if [ $failures_flag -eq 1 ]; then
  printf "%s", "$failures_message"
  exit 1
else
  echo "YA TIENES TU WP PARA TRABAJAR. ENTRA EN:" $WP_HOME_URL
fi

